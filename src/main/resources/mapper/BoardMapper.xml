<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nexacro.mapper.BoardMapper">

  <!-- 목록 조회 -->
  <select id="selectList"
          parameterType="com.nexacro.entity.BoardEntity"
          resultType="com.nexacro.entity.BoardEntity">

    <bind name="titleLike"
          value="title   != null and title   != '' ? '%' + title   + '%' : null" />
    <bind name="contentLike"
          value="content != null and content != '' ? '%' + content + '%' : null" />
    <bind name="authorLike"
          value="author  != null and author  != '' ? '%' + author  + '%' : null" />

    SELECT 
    	b.id, 
    	b.title, 
    	b.content, 
    	b.author
    FROM 
    	board b    <where>
      <if test="title != null and title != ''">
        AND LOWER(b.title) LIKE LOWER(#{titleLike}) ESCAPE '\'
      </if>
      <if test="content != null and content != ''">
        AND LOWER(b.content) LIKE LOWER(#{contentLike}) ESCAPE '\'
      </if>
      <if test="author != null and author != ''">
        AND LOWER(b.author) LIKE LOWER(#{authorLike}) ESCAPE '\'
      </if>
    </where>
    ORDER BY 
    	b.id DESC
  </select>

  <!-- 단건 INSERT -->
  <insert id="insertOne" parameterType="com.nexacro.dto.BoardRequest">
    INSERT INTO 
    	board (title, content, author)
    VALUES 
    	(
			#{title,jdbcType=VARCHAR},
        	#{content,jdbcType=VARCHAR},
        	#{author,jdbcType=VARCHAR}
        )
  </insert>

  <!-- 단건 UPDATE: null 필드는 미변경 -->
  <update id="updateOne" parameterType="com.nexacro.dto.BoardRequest">
    UPDATE 
    	board
    <set>
      <if test="title != null">   title   = #{title},   </if>
      <if test="content != null"> content = #{content}, </if>
      <if test="author != null">  author  = #{author},  </if>
    </set>
    WHERE 
    	id = #{id}
  </update>

  <!-- 다건 DELETE: IN 절 -->
  <delete id="deleteList" parameterType="list">
    DELETE FROM 
    	board
    WHERE 
    	id IN
    <foreach collection="ids" item="id" open="(" separator="," close=")">
      #{id}
    </foreach>
  </delete>

</mapper>
